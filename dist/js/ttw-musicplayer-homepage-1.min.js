/**
 * Originally created by 23rd and Walnut for Codebasehero.com, then modified for WordPress plugin by Enigma Digital
 * www.23andwalnut.com
 * www.codebasehero.com
 * www.enigmaweb.com.au
 * License: MIT License
 */
!function(a){a.fn.ttwMusicPlayer=function(t,e){var i,n,s,r,l,c,o,p,u,d,y=this;
    /** Common Functions **/
    function trackName(a){return isUndefined(u[a].title)?isUndefined(u[a].mp3)?isUndefined(u[a].oga)?"":fileName(u[a].oga):fileName(u[a].mp3):u[a].title}function fileName(a){return(a=a.split("/"))[a.length-1]}function setRating(a,t,e){"track"==a?isUndefined(u[e].rating)||function applyTrackRating(a,t){
    //multiply rating by 2 since the list ratings have 10 levels rather than 5
    a.find(s.ratingLevel).removeClass(attr(s.ratingLevelOn)).slice(0,2*t).addClass(attr(s.ratingLevelOn))}
    /** Utility Functions **/(t,u[e].rating):function applyCurrentlyPlayingRating(a){
    //reset the rating to 0, then set the rating defined above
    y.find(s.trackInfo).find(s.ratingLevel).removeClass(attr(s.ratingLevelOn)).slice(0,a).addClass(attr(s.ratingLevelOn))}(isUndefined(u[e].rating)?0:Math.ceil(u[e].rating))}function attr(a){return a.substr(1)}function isUndefined(a){return void 0===a}s={jPlayer:"#jquery_jplayer",jPlayerInterface:".jp-interface",playerPrevious:".jp-interface .jp-previous",playerNext:".jp-interface .jp-next",trackList:".tracklist",tracks:".tracks",track:".track",trackRating:".rating-bar",trackInfo:".track-info",rating:".rating",ratingLevel:".rating-level",ratingLevelOn:".on",rating_succes:".rating-succes",title:".title",duration:".duration",buy:".buy",buyNotActive:".not-active",playing:".playing",moreButton:".more",player:".player",artist:".artist",artistOuter:".artist-outer",albumCover:".img",description:".description",descriptionShowing:".showing"},i={ratingCallback:null,currencySymbol:"$",buyText:"BUY",tracksToShow:5,autoplay:!1,jPlayer:{}},n=a.extend(!0,{},i,e),u=t,d=0,r=function(){t=new l,(p=new c).buildInterface(),t.init(n.jPlayer),
    //don't initialize the ratings until the playlist has been built, which wont happen until after the jPlayer ready event
    y.bind("mbPlaylistLoaded",(function(){y.bind("mbInterfaceBuilt",(function(){new o})),p.init()}))},l=function(){var t,e,i,r,l=!1,c={},o=0,p=0;function playlistInit(a){d=0,a?playlistAdvance(d):(playlistConfig(d),y.trigger("mbPlaylistInit"))}function playlistConfig(a){d=a,c.jPlayer("setMedia",u[d])}function playlistAdvance(a){playlistConfig(a),a>=n.tracksToShow&&showMore(),y.trigger("mbPlaylistAdvance"),c.jPlayer("play")}function playlistNext(){playlistAdvance(d+1<u.length?d+1:0)}function playlistPrev(){playlistAdvance(d-1>=0?d-1:u.length-1)}function togglePlay(){l?c.jPlayer("pause"):c.jPlayer("play")}function showMore(){isUndefined(r)&&(r=y.find(s.moreButton)),i.animate({height:o+p},(function(){r.animate({opacity:0},(function(){r.slideUp((function(){r.parents(s.trackList).removeClass("show-more-button"),r.remove()}))}))}))}function duration(a){return isUndefined(u[a].duration)?"-":u[a].duration}function setBuyLink(a,t){isUndefined(u[t].buy)||a.find(s.buy).removeClass(attr(s.buyNotActive)).attr("href",u[t].buy).html(function buyText(a){return(isUndefined(u[a].price)?"":n.currencySymbol+u[a].price)+" "+n.buyText}(t))}return t={listItem:'<li class="track"><span class="title"></span><span class="duration"></span><a href="#" class="buy not-active" target="_blank"></a></li>',ratingBar:'<span class="rating-level rating-bar"></span>'},{init:function init(g){var v,f;c=a(".ttw-music-player .jPlayer-container"),v={swfPath:"jquery-jplayer",supplied:"mp3, oga",solution:"html, flash",cssSelectorAncestor:s.jPlayerInterface,errorAlerts:!1,warningAlerts:!1},
    //apply any user defined jPlayer options
    f=a.extend(!0,{},v,g),c.bind(a.jPlayer.event.ready,(function(){
    //Bind jPlayer events. Do not want to pass in options object to prevent them from being overridden by the user
    c.bind(a.jPlayer.event.ended,(function(a){playlistNext()})),c.bind(a.jPlayer.event.play,(function(a){c.jPlayer("pauseOthers"),e.eq(d).addClass(attr(s.playing)).siblings().removeClass(attr(s.playing))})),c.bind(a.jPlayer.event.playing,(function(a){l=!0})),c.bind(a.jPlayer.event.pause,(function(a){l=!1})),
    //Bind next/prev click events
    a(s.playerPrevious).click((function(){return playlistPrev(),a(this).blur(),!1})),a(s.playerNext).click((function(){return playlistNext(),a(this).blur(),!1})),y.bind("mbInitPlaylistAdvance",(function(a){var t=this.getData("mbInitPlaylistAdvance");t!=d?playlistAdvance(d=t):c.data("jPlayer").status.srcSet?togglePlay():playlistAdvance(0)})),function buildPlaylist(){var l=a();i=y.find(s.tracks);
    //set up the html for the track ratings
    for(var c=0;c<10;c++)l=l.add(t.ratingBar);for(var d=0;d<u.length;d++){var g=a(t.listItem);
    //since $ratings refers to a specific object, if we just use .html($ratings) we would be moving the $rating object from one list item to the next
    g.find(s.rating).html(l.clone()),g.find(s.title).html(trackName(d)),g.find(s.duration).html(duration(d)),setRating("track",g,d),setBuyLink(g,d),g.data("index",d),i.append(g)}if((e=a(s.track)).slice(0,n.tracksToShow).each((function(){o+=a(this).outerHeight()})),e.slice(n.tracksToShow,u.length).each((function(){p+=a(this).outerHeight()})),p>0){var v=a(s.trackList);i.height(o),v.addClass("show-more-button"),v.find(s.moreButton).click((function(){r=a(this),showMore()}))}e.find(".title").click((function(){playlistAdvance(a(this).parents("li").data("index"))}))}(),
    //If the user doesn't want to wait for widget loads, start playlist now
    y.trigger("mbPlaylistLoaded"),playlistInit(n.autoplay)})),
    //Initialize jPlayer
    c.jPlayer(f)},playlistInit:playlistInit,playlistAdvance:playlistAdvance,playlistNext:playlistNext,playlistPrev:playlistPrev,togglePlay:togglePlay,$myJplayer:c}},o=function(){y.find(s.track);
    //Handler for when user hovers over a rating
    a(s.rating).find(s.ratingLevel).hover((function(){a(this).addClass("hover").prevAll().addClass("hover").end().nextAll().removeClass("hover")})),
    //Restores previous rating when user is finished hovering (assuming there is no new rating)
    a(s.rating).mouseleave((function(){a(this).find(s.ratingLevel).removeClass("hover")})),function bindEvents(){a(s.rating_succes).css("display","none"),
    //Set the new rating when the user clicks
    a(s.ratingLevel).click((function(){var t=a(this),e="action=my_special_ajax_call5&rating="+(t.parent().children().index(t)+1)+"&trackname="+a(s.title+":first").text();
    //alert(postdata1);
    jQuery.ajax({type:"POST",url:ajaxurl,cache:!1,data:e,beforeSend:function(){},success:function(t){a(s.rating_succes).html(t).fadeIn(500).delay(1e3).fadeOut(500);
    //window.setTimeout(function(){location.reload()},2000);
    }}),t.prevAll().add(t).addClass(attr(s.ratingLevelOn)).end().end().nextAll().removeClass(attr(s.ratingLevelOn))}))}()},c=function(){var t,e,i,r;return{buildInterface:function buildInterface(){var t;
    //I would normally use the templating plugin for something like this, but I wanted to keep this plugin's footprint as small as possible
    t=a('<div class="ttw-music-player"><div class="player jp-interface"><div class="album-cover"><span class="img"></span>            <span class="highlight"></span>        </div>        <div class="track-info">            <p class="title"></p>            <p class="artist-outer">By <span class="artist"></span></p>            <div class="rating">                <span class="rating-level rating-star on"></span>                <span class="rating-level rating-star on"></span>                <span class="rating-level rating-star on"></span>                <span class="rating-level rating-star on"></span>                <span class="rating-level rating-star"></span>\t\t\t\t <span class="rating-succes">Already rated</span>            </div>        </div>        <div class="player-controls">            <div class="main">                <div class="previous jp-previous"></div>                <div class="play jp-play"></div>                <div class="pause jp-pause"></div>                <div class="next jp-next"></div>\x3c!-- These controls aren\'t used by this plugin, but jPlayer seems to require that they exist --\x3e                <span class="unused-controls">                    <span class="jp-video-play"></span>                    <span class="jp-stop"></span>                    <span class="jp-mute"></span>                    <span class="jp-unmute"></span>                    <span class="jp-volume-bar"></span>                    <span class="jp-volume-bar-value"></span>                    <span class="jp-volume-max"></span>                    <span class="jp-current-time"></span>                    <span class="jp-duration"></span>                    <span class="jp-full-screen"></span>                    <span class="jp-restore-screen"></span>                    <span class="jp-repeat"></span>                    <span class="jp-repeat-off"></span>                    <span class="jp-gui"></span>                </span>            </div>            <div class="progress-wrapper">                <div class="progress jp-seek-bar">                    <div class="elapsed jp-play-bar"></div>                </div>            </div>        </div>    </div>    <div class="tracklist">        <ol class="tracks"> </ol>        <div class="more">View More...</div>    </div>    <div class="jPlayer-container"></div></div>').css({display:"none",opacity:0}).appendTo(y).slideDown("slow",(function(){t.animate({opacity:1}),y.trigger("mbInterfaceBuilt")}))},init:function init(){t=a(s.player),e=t.find(s.title),i=t.find(s.artist),r=t.find(s.albumCover),function setDescription(){isUndefined(n.description)||y.find(s.description).html(n.description).addClass(attr(s.descriptionShowing)).slideDown()}(),y.bind("mbPlaylistAdvance mbPlaylistInit",(function(){!function setTitle(){e.html(trackName(d))}(),function setArtist(){isUndefined(u[d].artist)?i.parent(s.artistOuter).animate({opacity:0},"fast"):i.html(u[d].artist).parent(s.artistOuter).animate({opacity:1},"fast")}(),setRating("current",null,d),function setCover(){r.animate({opacity:0},"fast",(function(){isUndefined(u[d].cover)||d==d&&r.css({opacity:1}).html('<img src="'+u[d].cover+'" alt="album cover" />')}))}()}))}}},r()}}(jQuery),
    // $('img.photo',this).imagesLoaded(myFunction)
    // execute a callback when all images have loaded.
    // needed because .load() doesn't work on cached images
    // mit license. paul irish. 2010.
    // webkit fix from Oren Solomianik. thx!
    // callback function is passed the last image to load
    //   as an argument, and the collection as `this`
    jQuery.fn.imagesLoaded=function(a){var t=this.filter("img"),e=t.length;return t.bind("load",(function(){--e<=0&&a.call(t,this)})).each((function(){
    // cached images don't fire load sometimes, so we reset src.
    if(this.complete||void 0===this.complete){var a=this.src;
    // webkit hack from http://groups.google.com/group/jquery-dev/browse_thread/thread/eee6ab7b2da50e1f
    // data uri bypasses webkit log warning (thx doug jones)
    this.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",this.src=a}})),this};var myPlaylist=[{mp3:"media/Dream-Music-Relax.mp3",oga:"media/Dream-Music-Relax.ogg",title:"Energy",artist:"Young & Free",rating:"5",buy:"Buy",price:"123",duration:"3:30",cover:"../images/logo.png"},{mp3:"media/Dream-Music-Relax.mp3",oga:"media/Dream-Music-Relax.ogg",title:"Pursue",artist:"Young & Free",rating:"5",buy:"Buy",price:"123",duration:"7:03",cover:"../images/logo.png"},{mp3:"media/Dream-Music-Relax.mp3",oga:"media/Dream-Music-Relax.ogg",title:"This Is Living (Acoustic)",artist:"Young & Free",rating:"5",buy:"Buy",price:"123",duration:"4:24",cover:"../images/logo.png"},{mp3:"media/Dream-Music-Relax.mp3",oga:"media/Dream-Music-Relax.ogg",title:"Sinking Deep",artist:"Young & Free",rating:"5",buy:"Buy",price:"123",duration:"4:07",cover:"../images/logo.png"}];jQuery(document).ready((function(){jQuery("#myplayer").ttwMusicPlayer(myPlaylist,{currencySymbol:"",description:"",buyText:"",tracksToShow:4,autoplay:!1})}));